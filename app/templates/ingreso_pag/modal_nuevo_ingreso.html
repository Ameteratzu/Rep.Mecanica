<div class="modal fade" id="nuevoIngresoModal" tabindex="-1" aria-labelledby="nuevoIngresoLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title text-center w-100" id="nuevoIngresoLabel">Registrar Ingresos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <form action="{{ url_for('ingreso.nuevo_ingreso') }}" method="POST">
        <div class="modal-body">
          <!-- Datos del ingreso -->
          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label for="referencia" class="form-label">Documento de Referencia</label>
              <input type="text" name="referencia" id="referencia" class="form-control" required>
            </div>
            <div class="col-md-3 ms-auto">
              <label for="guia" class="form-label">Guía</label>
              <input type="text" class="form-control" id="guia" name="guia" value="{{ guia_tentativa }}" readonly>
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label for="concepto" class="form-label">Concepto</label>
              <input type="text" name="concepto" id="concepto" class="form-control" required>
            </div>
            <div class="col-md-3">
              <label for="fecha" class="form-label">Fecha</label>
              <input type="date" name="fecha" id="fecha" class="form-control" required>
            </div>
          </div>

          <!-- Proveedor -->
          <h6 class="modal-title mt-3">Proveedor de Procedencia</h6>
          <div class="row g-2 mb-2">
            <div class="col-md-3">
              <button type="button" 
                    class="btn btn-secondary w-100 btnBuscarProveedor"
                    data-proveedor-id="proveedor_id"
                    data-proveedor-ruc="ruc"
                    data-proveedor-razon="razon_social"
                    data-proveedor-telefono="telefono"
                    data-proveedor-direccion="direccion">
                    Seleccionar Proveedor
                </button>

            </div>
          </div>
          <div class="row g-2 mb-2">
            <div class="col-md-4">
              <label for="ruc" class="form-label">RUC</label>
              <input type="text" name="ruc" id="ruc" class="form-control" required readonly>
            </div>
            <div class="col-md-4">
              <label for="razon_social" class="form-label">Razón Social</label>
              <input type="text" name="razon_social" id="razon_social" class="form-control" required readonly>
            </div>
            <div class="col-md-4">
              <label for="telefono" class="form-label">Teléfono</label>
              <input type="text" name="telefono" id="telefono" class="form-control" required readonly>
            </div>
          </div>

          <div class="row g-2 mb-3">
            <div class="col-md-6">
              <label for="direccion" class="form-label">Dirección</label>
              <input type="text" name="direccion" id="direccion" class="form-control" required readonly>
            </div>
          </div>

          <input type="hidden" name="proveedor_id" id="proveedor_id">

          <!-- Agregar productos -->
          <h6 class="modal-title mt-4">Productos</h6>
          <div class="row g-2 my-2">
            <div class="col-md-2">
              <button type="button" class="btn btn-secondary abrir-modal-secundario"
                      data-modal-origen="nuevoIngresoModal"
                      data-modal-destino="modalProducto">
                <i class="fas fa-search"></i> Buscar Producto
              </button>
            </div>
          </div>
          <!-- Formulario de datos del producto seleccionado -->
          <div class="row g-2 mb-3">
            <div class="col-md-3">
              <label for="codigoProducto" class="form-label">Código</label>
              <input type="text" id="codigoProducto" class="form-control" readonly>
            </div>
            <div class="col-md-4">
              <label for="nombreProducto" class="form-label">Nombre</label>
              <input type="text" id="nombreProducto" class="form-control" readonly>
            </div>
            <div class="col-md-2">
              <label for="cantidadProducto" class="form-label">Cantidad</label>
              <input type="number" id="cantidadProducto" class="form-control" min="1">
            </div>
            <div class="col-md-2">
              <label for="costoProducto" class="form-label">Costo</label>
              <input type="number" id="costoProducto" class="form-control" min="0" step="0.01">
            </div>
            <div class="col-md-1 d-flex align-items-end">
              <button type="button" id="btnAgregarProducto" class="btn btn-success w-100">+</button>
            </div>
          </div>

          <table class="table table-hover table-striped">
            <thead class="table-dark">
              <tr>
                <th>Código</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Costo</th>
                <th>Total</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody id="productosAgregados">
              <!-- Productos agregados aquí -->
            </tbody>
            <tfoot>
              <tr>
                <td colspan="4" class="text-end fw-bold">Total General:</td>
                <td id="totalGeneral" class="fw-bold">0.00</td>
                <td></td>
              </tr>
            </tfoot>
          </table>

          <!-- Observación -->
          <div class="row g-2 mt-3">
            <div class="col-md-6">
              <label for="observacion" class="form-label">Observación</label>
              <input type="text" name="observacion" id="observacion" class="form-control" required>
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>