{% extends "base.html" %}

{% block content %}
  <h2>{% if cliente %}Editar{% else %}Nuevo{% endif %} Cliente</h2>

  <form method="post" action="{{ url_for('cliente.nuevo_cliente') }}" onsubmit="return validarFormulario()">
    <div class="row">
      <div class="col-md-6">
        <label for="nombres" class="form-label">Nombres</label>
        <input type="text" name="nombres" class="form-control" value="{{ cliente.nombres if cliente else '' }}" required pattern="[A-Za-záéíóúÁÉÍÓÚ\s]+" title="Solo se permiten letras y espacios">
      </div>
      <div class="col-md-6">
        <label for="apellidos" class="form-label">Apellidos</label>
        <input type="text" name="apellidos" class="form-control" value="{{ cliente.apellidos if cliente else '' }}" required pattern="[A-Za-záéíóúÁÉÍÓÚ\s]+" title="Solo se permiten letras y espacios">
      </div>
    </div>

    <div class="col-md-6">
      <label for="tipo_documento" class="form-label">Tipo Documento</label>
      <select name="tipo_documento" id="tipo_documento" class="form-select" required>
        <option value="">Seleccione</option>
        <option value="DNI" {% if cliente and cliente.tipo_documento == 'DNI' %}selected{% endif %}>DNI</option>
        <option value="RUC" {% if cliente and cliente.tipo_documento == 'RUC' %}selected{% endif %}>RUC</option>
        <option value="Carnet Extranjería" {% if cliente and cliente.tipo_documento == 'Carnet Extranjería' %}selected{% endif %}>Carnet Extranjería</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="documento" class="form-label">Nº Documento</label>
      <input type="text" name="documento" class="form-control" value="{{ cliente.documento if cliente else '' }}" required>
    </div>

    <div class="col-md-6">
      <label for="celular" class="form-label">Celular</label>
      <input type="text" name="celular" class="form-control" value="{{ cliente.celular if cliente else '' }}" required pattern="^9\d{8}$" title="El número debe comenzar con 9 y contener exactamente 9 dígitos">
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label for="ubigeo" class="form-label">Ubigeo</label>
        <select name="ubigeo" class="form-select" required>
          <option value="" disabled {% if not cliente %}selected{% endif %}>Seleccione el Ubigeo</option>
          {% for ubigeo in ubigeos %}
            <option value="{{ ubigeo.id }}" {% if cliente and cliente.ubigeo.id == ubigeo.id %}selected{% endif %}>
              {{ ubigeo.departamento }} / {{ ubigeo.provincia }} / {{ ubigeo.distrito }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-6">
        <label for="estado" class="form-label">Estado</label>
        <select name="activo" class="form-select" required>
          <option value="1" {% if cliente and cliente.activo %}selected{% endif %}>Activo</option>
          <option value="0" {% if cliente and not cliente.activo %}selected{% endif %}>Inactivo</option>
        </select>
      </div>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-primary">Guardar Cliente</button>
      <a href="{{ url_for('cliente.list_cliente') }}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>

  <script>
    function validarFormulario() {
      const celular = document.querySelector('[name="celular"]');
      const correo = document.querySelector('[name="correo"]');
      
       // Validación para nombres y apellidos
        if (!letrasRegex.test(nombres)) {
            error = 'El campo de nombres solo puede contener letras y espacios.';
        } else if (!letrasRegex.test(apellidos)) {
            error = 'El campo de apellidos solo puede contener letras y espacios.';
        }

        if (error) {
            e.preventDefault();
            alert(error);
        }

         // Validación para el celular
        if (!celularRegex.test(celular)) {
            error = 'El celular debe contener exactamente 9 numero e iniciar con 9.';
        }
x   
        if (error) {
            e.preventDefault();
            alert(error);
        }
    });


      return true;
    }
  </script>
{% endblock %}
